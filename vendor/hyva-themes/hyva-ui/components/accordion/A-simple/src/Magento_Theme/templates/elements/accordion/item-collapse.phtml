<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\SvgIcons;
use Hyva\Theme\ViewModel\HeroiconsSolid;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;

/** @var Escaper $escaper */
/** @var Template $block */
/** @var ViewModelRegistry $viewModels */

/** @var SvgIcons $hyvaicons */
$hyvaicons = $viewModels->require(SvgIcons::class);

/** @var HeroiconsSolid $heroiconsSolid */
$heroiconsSolid = $viewModels->require(HeroiconsSolid::class);

$title = (string) $block->getTitle() ?: __("Details");
$content = (string) $block->getContent() ?: "";
$open = (bool) $block->getOpen() ? 'true' : 'false';
$icon = (string) $block->getIcon() ?: '';

?>

<div
    data-collapse
    x-data="{ open: <?= /** @noEscape */ $open ?> }"
    x-defer="intersect"
    x-id="['collapse-id']"
>
    <button
        class="group flex w-full items-center justify-between py-3 font-bold"
        @click="open = !open"
        :aria-expanded="open"
        :aria-controls="$id('collapse-id')"
    >
        <span class="flex items-center gap-2">
            <?php if ($icon): ?>
                <?= $hyvaicons->renderHtml($icon, 'text-blue-900', 18, 18, ['aria-hidden' => 'true']); ?>
            <?php endif; ?>
            <?= $escaper->escapeHtml($title); ?>
        </span>
        <span x-cloak class="transition-transform group-aria-expanded:rotate-180">
            <?= $heroiconsSolid->chevronDownHtml('', 20, 20, ['aria-hidden' => 'true']); ?>
        </span>
    </button>
    <div
        x-show="open"
        x-collapse
        x-cloak
        :id="$id('collapse-id')"
        :aria-labelledby="$id('collapse-id')"
        :aria-hidden="open ? 'false' : 'true'"
    >
        <div class="pb-3">
            <?php if ($block->getChildHtml()): ?>
                <?= $block->getChildHtml(); ?>
            <?php else: ?>
                <?= $escaper->escapeHtml($content); ?>
            <?php endif; ?>
        </div>
    </div>
</div>
