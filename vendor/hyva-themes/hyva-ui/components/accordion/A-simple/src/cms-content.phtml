<!--
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */
-->

<section x-data="hyvaAccordion()" x-defer="intersect" class="py-3 px-6 bg-gray-100 divide-y">
    <div x-data="{ open: false }" x-defer="intersect" x-id="['details-id']">
        <button
            role="tab"
            class="group flex w-full items-center justify-between py-3 font-bold"
            @click="open = !open"
            :aria-expanded="open"
            :aria-controls="$id('collapse-id')"
        >
            <span>Question 1</span>
            <span x-cloak class="transition-transform group-aria-expanded:rotate-180">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </span>
        </button>
        <div
            role="tabpanel"
            x-show="open"
            x-collapse
            x-cloak
            :aria-labelledby="$id('details-id')"
            :aria-hidden="open ? 'false' : 'true'"
        >
            <div class="pb-3">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit.
            </div>
        </div>
    </div>
    <div x-data="{ open: false }" x-defer="intersect" x-id="['details-id']">
        <button
            role="tab"
            class="group flex w-full items-center justify-between py-3 font-bold"
            @click="open = !open"
            :aria-expanded="open"
            :aria-controls="$id('collapse-id')"
        >
            <span>Question 2</span>
            <span x-cloak class="transition-transform group-aria-expanded:rotate-180">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </span>
        </button>
        <div
            role="tabpanel"
            x-show="open"
            x-collapse
            x-cloak
            :aria-labelledby="$id('details-id')"
            :aria-hidden="open ? 'false' : 'true'"
        >
            <div class="pb-3">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit.
            </div>
        </div>
    </div>
</section>

<script>
    function hyvaAccordion({ multiselectable = false, childOpenStateName = 'open' } = {}) {
        return {
            accordion: null,
            init() {
                this.$el.setAttribute('role', 'region');
                this.$el.setAttribute('aria-multiselectable', multiselectable);
                this.accordion = this.$el.addEventListener('click', (event) => {
                    if (multiselectable) return;
                    const target = event.target.closest('[x-data]');
                    if (!target) return;
                    this.toggleItems(target);
                });
            },
            destroy() {
                removeEventListener(this.accordion);
            },
            toggleItems(target) {
                const items = [...this.$root.children];
                if (!items) return;

                items.forEach(item => {
                    if (item._x_ids !== target._x_ids) {
                        Alpine.$data(item)[childOpenStateName] = false;
                    }
                });
            },
        }
    }
</script>
